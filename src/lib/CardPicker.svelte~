<script>
  import Card from '$lib/Card.svelte';
  import Pool from '$lib/Pool.svelte';
  import { create_crossfade } from '$lib/crossfade';

  const [send, receive] = create_crossfade();

  export let cards;

  $: cardpool = cards.forEach((card, idx) => {{
    key: idx,
    name: card.name,
    selected: false,
    inflight: false,
  }});

  function toggle_selected(card) {
    return () => {
      if (!card.inflight) {
	card.inflight = true;
	card.selected = !card.selected;
	// trigger re-render
	cardpool = cardpool;
      }
    }
  }

  function arrived(card) {
    card.inflight = false;
  }

</script>

<div class="cardpool">
  <p>Card Pool</p>
  <Pool pool={cardpool.filter(c => !c.selected)}
    outroend={arrived}
    {send} {receive}
    let:item={card}>
    <Card name={card.name} on:click={toggle_selected(card)} />
  </Pool>
</div>

<div class="selected">
  <p>Selected Cards</p>
  <Pool pool={cardpool.filter(c => c.selected)}
    outroend={arrived}
    {send} {receive}
    let:item={card}>
    <Card name={card.name} on:click={toggle_selected(card)} />
  </Pool>
</div>

<style>
  .cardpool, .selected {
    float: left;
    width: 50%;
  }
</style>
